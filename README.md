# NetInsight - 网络检测分析平台

NetInsight是一个基于前后端架构的网络检测分析平台，支持用户上传HAR文件和TCPdump生成的pcap文件，通过后端数据分析引擎生成多维度的网络环境报告，帮助用户和网络管理员快速识别网络性能瓶颈、安全威胁及流量模式问题。

## 项目功能

- **多协议支持**：兼容 HAR（HTTP 流量）和 pcap（全流量）文件
- **智能分析**：自动识别网络延迟、丢包、异常请求、安全威胁
- **可视化报告**：交互式图表展示流量分布、性能指标、安全事件
- **角色化视图**：为不同角色提供定制化分析视角（如性能/安全/运维）
- **问题自动定位**：智能推荐可能的问题根因和解决方案
- **权限管理**：基于角色的权限管理，精细控制用户访问权限

## 技术栈

- **前端**：React + TypeScript + Ant Design Pro
- **后端**：Python Flask + Celery（异步任务处理）
- **数据库**：SQLite/PostgreSQL + Redis + InfluxDB
- **文件解析**：内置JSON解析引擎 + Scapy/tshark

## 项目结构

```
/
├── frontend/              // 前端React应用
│   ├── public/            // 静态资源
│   └── src/               // 源代码
│       ├── components/    // 组件
│       ├── pages/         // 页面
│       ├── services/      // API服务
│       ├── utils/         // 工具函数
│       └── App.tsx        // 主应用
├── backend/               // 后端Flask应用
│   ├── app/               // 应用代码
│   │   ├── api/           // API路由
│   │   ├── auth/          // 认证模块
│   │   ├── models/        // 数据模型
│   │   ├── services/      // 业务逻辑
│   │   └── utils/         // 工具函数
│   ├── config/            // 配置文件
│   └── tests/             // 测试代码
├── docs/                  // 文档
├── proto/                 // 原型设计
└── docker/                // Docker配置
```

## 开发指南

### 环境配置

1. 安装Node.js和npm
2. 安装Python 3.8+和pip
3. 安装SQLite或PostgreSQL和Redis

### 启动前端

```bash
cd frontend
npm install
npm start
```

### 启动后端

```bash
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
python init_db.py  # 初始化数据库和测试用户
python wsgi.py
```

## 功能模块

- **用户认证**：注册、登录、密码重置
- **文件上传**：支持HAR和pcap文件上传
- **数据分析**：流量统计、性能指标、安全检测
- **报告生成**：交互式仪表盘、自定义报告
- **用户管理**：角色权限、团队协作
- **权限控制**：基于角色的访问控制，精细权限配置
- **告警通知**：异常检测、通知渠道

## 开发进度

### 已完成的功能
1. **用户认证系统**：支持用户注册、登录、密码找回等功能，确保系统安全访问。
2. **角色权限管理模块**：完整的RBAC（基于角色的访问控制）系统，可以灵活分配不同用户的权限。
3. **文件上传功能**：支持PCAP、PCAPNG等多种格式网络抓包文件的上传，支持文件完整性校验和格式验证，并能自动解析文件内容。上传后的文件可以进行各种网络分析。
4. **成员管理功能**：管理员可以添加、编辑、删除系统成员，并能分配不同的角色和权限。
5. **网络分析报告模块**：基于上传的网络抓包文件，系统可生成详细的网络分析报告，包括安全事件检测、流量统计、HTTP请求分析等，并提供丰富的可视化展示。

### 进行中功能
1. **高级分析引擎优化**：进一步提升分析引擎的性能和精度，支持更多协议和异常检测能力。
2. **数据可视化报表**：通过各种图表和可视化方式，直观展示网络流量特征和安全风险。
3. **API接口功能**：向第三方系统提供API接口，支持自动化分析和集成。
4. **批量分析功能**：支持同时分析多个网络抓包文件，提高工作效率。

### 测试账号

系统已预置以下测试账号：

- 管理员: `admin@example.com` / `admin123`
- 分析师: `analyst@example.com` / `analyst123` 
- 普通用户: `user@example.com` / `user123`

### 访问权限说明

系统实现了基于角色的权限管理：

- **管理员**：拥有所有功能的访问和操作权限
- **分析师**：可以访问仪表盘、文件上传和报告分析功能
- **普通用户**：只能访问仪表盘功能

管理员可以通过角色权限管理功能，创建自定义角色并分配具体权限，实现更精细的权限控制。

### 计划功能

- [ ] 团队协作功能
- [ ] 告警和通知系统
- [ ] 数据导出
- [ ] 移动端适配

## 问题排查

如遇到问题，请检查：

1. 确保前后端服务均已启动
2. 检查浏览器控制台是否有错误信息
3. 后端服务日志中是否有异常记录
4. 数据库连接是否正常

## 贡献指南

1. Fork项目仓库
2. 创建功能分支 (`git checkout -b feature/amazing-feature`)
3. 提交更改 (`git commit -m 'Add some amazing feature'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 创建Pull Request 

## 报告功能详细说明

### 网络分析报告

网络分析报告模块是NetInsight平台的核心功能之一，它通过深度分析网络抓包文件，为用户提供全面的网络性能和安全洞察。主要特点包括：

1. **报告生成**：用户可以基于已上传的网络抓包文件，选择不同的分析类型（综合分析、安全分析、性能分析、流量分析）生成定制化报告。

2. **多维度分析**：
   - **安全事件检测**：识别潜在的安全威胁，如可疑连接、异常流量模式、恶意软件特征等
   - **流量统计**：分析网络流量模式，包括数据包数量、连接数、唯一IP数等指标
   - **HTTP请求分析**：详细展示HTTP/HTTPS请求，包括URL、方法、状态码、响应时间等

3. **状态跟踪**：报告生成过程透明可见，从等待处理、处理中到完成的全流程跟踪。

4. **事件管理**：分析师可以对检测到的安全事件进行标记（已解决、已忽略）和跟踪，确保问题得到妥善处理。

5. **导出功能**：支持将报告导出为PDF或CSV格式，方便与团队分享或存档。

### 使用流程

1. 在"文件上传"页面上传网络抓包文件
2. 文件处理完成后，进入"报告"页面点击"生成新报告"
3. 选择文件、填写报告标题并选择分析类型
4. 系统开始处理并生成报告，完成后可查看详情
5. 在报告详情页面，可以查看安全事件、HTTP请求和流量统计等信息

### 权限控制

- **分析师和管理员**：可以生成报告、查看所有报告、管理安全事件
- **普通用户**：仅能查看分配给他们的报告 

## 问题修复记录

### JWT认证问题修复

我们遇到了前端无法登录的问题，主要原因是后端使用了两种不同的JWT验证方式：

1. 自定义的JWT验证装饰器（在`app/auth/utils.py`中）
2. Flask-JWT-Extended提供的验证机制（在`app/auth/routes.py`中）

这导致了一些API端点使用一种验证方式，而其他端点使用另一种，造成了前端无法一致地访问这些端点。

#### 解决方案

我们修改了后端代码，统一使用Flask-JWT-Extended提供的验证机制：

1. 更新了`jwt_required`装饰器，使用`verify_jwt_in_request`和`get_jwt_identity`进行JWT验证
2. 同样更新了`admin_required`和`analyst_required`装饰器
3. 更新了`permission_required`装饰器，使其与其他装饰器一致
4. 移除了`routes.py`中的重复装饰器定义，改为导入`utils.py`中的装饰器

### 数据库初始化问题

在初始化数据库时，我们遇到了一些问题，特别是与User模型相关的问题。

#### 解决方案

1. 修复了User初始化的问题，确保密码正确设置
2. 创建了报告相关的数据库表
3. 正确初始化了用户角色和权限

### API路径问题

前端的文件上传API路径与后端不匹配。

#### 解决方案

更新了前端的文件上传API路径，从`/files/upload`改为`/files`，以匹配后端路由。

## 启动项目

### 后端启动

```bash
cd backend
source venv/bin/activate
python wsgi.py
```

### 前端启动

```bash
cd frontend
npm start
```

## 用户账号

默认管理员账号：
- 邮箱: admin@example.com
- 密码: admin123

分析师账号：
- 邮箱: analyst@example.com
- 密码: analyst123

普通用户账号：
- 邮箱: user@example.com
- 密码: user123 